<!DOCTYPE html>

<html>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no' />
    <title>Label Master</title>
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'
        integrity='sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T' crossorigin='anonymous'>
    <link href='https://use.fontawesome.com/releases/v5.6.1/css/all.css' rel='stylesheet'>
    <link rel='stylesheet' href='{{ url_for('static', filename='index.css') }}'>
</head>

<body>
    <div class="container">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link{% if active_tab == 'home' %} active{% endif %}" href="#" onclick="openTab(event, 'home')">é¦–é </a>
            </li>
            <li class="nav-item">
                <a class="nav-link{% if active_tab == 'upload' %} active{% endif %}" href="#" onclick="openTab(event, 'upload')">ä¸Šå‚³é é¢</a>
            </li>
            <li class="nav-item">
                <a class="nav-link{% if active_tab == 'result' %} active{% endif %}" href="#" onclick="openTab(event, 'result')" style="display:none;">ä¸Šå‚³çµæœ</a>
            </li>
        </ul>

        <div id="toggleDashboardContainer">
            <button id="toggleDashboard" onclick="toggleDashboard()">Labeling Coverage</button>
            <div class='dashboard' style="display: none;">
                <ul class="dashboard-info">
                    <li>Cover Rate: {{ coverRate }}</li>
                    <li>Mean: {{ mean }}</li>
                    <li>STD: {{ std }}</li>
                </ul>
            </div>
        </div>


        <div id="home" class="tab-content active">
            <!-- é¦–é çš„å…§å®¹ -->
            <div>
                <center>
                    <br>
                    <br>
                    <form action method='POST'>

                        <div class="highlighted-text-container">
                            <h2 class="highlighted-text">{{ text }}</h2>
                        </div>
                        <br>
                        <input name='idx' value='{{ idx }}' style='display: none'>
                        <br>
                        <h2>è©•åˆ†</h2>
                        <div class="score-slider">
                          <input type="range" min="1" max="5" step="1" value="3" name="score">
                          <div class="slider-tick">
                            <span>1</span>
                            <span>2</span>
                            <span>3</span>
                            <span>4</span>
                            <span>5</span>
                          </div>
                        </div>

                        <br>
                        <h2>æƒ…ç·’å–®é¸ï¼ˆSentimentï¼‰</h2><br>
                        <select name="tag" id="sentiment-select">
                            <option value="happy">happyğŸ˜€</option>
                            <option value="angry">angryğŸ˜¡</option>
                            <option value="wow" selected>wowğŸ˜²</option>
                            <option value="sad">sadğŸ˜¢</option>
                            <option value="none">noneğŸ˜</option>
                        </select>
                        <br>
                        <br>
                        <h2>é¡å‹é¸æ“‡ï¼ˆTypeï¼‰</h2>
                        <select name="type">
                          <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                          <option value="æ—¥æ›†">æ—¥æ›†</option>
                          <option value="å°è¦½">å°è¦½</option>
                          <option value="å•ç­”">å•ç­”</option>
                          <option value="è¼•æ‡‰ç”¨">è¼•æ‡‰ç”¨</option>
                          <option value="åª’é«”æŒ‡ä»¤">åª’é«”æŒ‡ä»¤</option>
                          <option value="é–’èŠ">é–’èŠ</option>
                          <option value="äººå·¥å®¢æœ">äººå·¥å®¢æœ</option>
                          <option value="å¤©æ°£">å¤©æ°£</option>
                          <option value="å°èˆª">å°èˆª</option>
                          <option value="æ¥å¾…">æ¥å¾…</option>
                          <option value="é©—è­‰ç¢¼">é©—è­‰ç¢¼</option>
                          <option value="å¼•é ˜">å¼•é ˜</option>
                          <option value="è¨»å†Š">è¨»å†Š</option>
                          <option value="é€šç”¨æŒ‡ä»¤">é€šç”¨æŒ‡ä»¤</option>
                        </select>
                        <br>
                        <br>

                        <h2>è‡ªå®šç¾©æ¨™ç±¤ï¼ˆOptionalï¼‰</h2>
                        <br>
                        <div class="add-custom-tag">
                            <input type="text" name="addText" placeholder="Add a new tag...">
                            <button type="button" onclick="addCheckbox()">Add</button>
                            <button type="button" onclick="removeCheckbox()">Remove</button>
                        </div>
                        <br>
                        <div class="custom-tags">
                            {% for customTag in customTags %}
                            <div class="custom-tag">
                                <input type="checkbox" name="tag_opt" value="{{ customTag }}">
                                <label>{{ customTag }}</label>
                            </div>
                            {% endfor %}
                        </div>
                        <br>
                        <input type='submit' value='é€å‡ºï¼' class='submit-button'>
                    </form>
                    <br>
                    <br>
                </center>
            </div>
        </div>

        <div id="upload" class="tab-content" style="display:none;">
            <!-- ä¸Šå‚³é é¢çš„å…§å®¹ -->
            <div class="upload-page">
                <center>
                    <h1>ä¸Šå‚³ä½ æƒ³æ¨™è¨»çš„è³‡æ–™ï¼</h1>
                    <form id='uploadForm' enctype='multipart/form-data'>
                        <input type='file' name='file'>
                        <input type='button' value='Upload' onclick="uploadFile()">
                    </form>
                    <br>
                    <br>
                    <a href='/upload/textDataExample.csv'>æŒ‰æˆ‘ä¸‹è¼‰ç¯„æœ¬æ ¼å¼ï¼ˆ.csvï¼‰</a>
                    <br>
                    <br>
                    <h3>è«‹æŒ‰ç…§ä¸‹åˆ—è¡¨æ ¼çš„æ ¼å¼å¡«å¯«ï¼</h3>
                    <br>
                    <table border='1'>
                        <tr>
                            <td>
                                <center>
                                    <h4>Text</h4>
                                </center>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <center>è‡ºåŒ—å¸‚æœ‰å¸Œæœ›äº†ï¼ B-)</center>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <center>ä¸€ç¾¤åƒåœ¾ å¹¹</center>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <center>æ²’åšåŠŸèª²å°±ä¾†è¨ç½µ</center>
                            </td>
                        </tr>

                    </table>

                    <br>

                    <h3>Sample Source from</h3>
                    <a href='https://github.com/sweslo17/chinese_sentiment'>https://github.com/sweslo17/chinese_sentiment</a>

                </center>
                <br>
                <br>
            </div>
            
        </div>

        <div id="result" class="tab-content" style="display:block;">
            <!-- ä¸Šå‚³çµæœçš„å…§å®¹ -->
            <div>
                <center>
                    <h1 id="uploadResultText"></h1>
                    <br>
                    <h2 id="uploadResultDetail"></h2>
                    <br>
                </center>
            </div>
        </div>
    </div>

    <script>

        function toggleDashboard() {
            var dashboard = document.querySelector('.dashboard');
            var button = document.getElementById('toggleDashboard');
            if (dashboard.style.display === 'none') {
                dashboard.style.display = 'block';
                button.classList.add('active');
            } else {
                dashboard.style.display = 'none';
                button.classList.remove('active');
            }
        }


        function openTab(evt, tabName) {
            var i, tabContent, navLinks;
            tabContent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            navLinks = document.getElementsByClassName("nav-link");
            for (i = 0; i < navLinks.length; i++) {
                navLinks[i].className = navLinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            if (evt) {
                evt.currentTarget.className += " active";
            }
        }

        function addCheckbox() {
            var textBox = document.getElementsByName('addText')[0];
            if (textBox.value != '') {
                var divElement = document.createElement('div');
                var tagOpts = document.getElementsByClassName('custom-tags')[0];
                var cb = document.createElement('input');
                cb.setAttribute('type', 'checkbox');
                cb.setAttribute('value', textBox.value);
                cb.setAttribute('checked', 'checked');
                cb.setAttribute('name', 'tag_opt');
                var label = document.createElement('label');
                label.textContent = textBox.value;
                label.appendChild(cb);
                divElement.appendChild(label);
                tagOpts.appendChild(divElement);
                textBox.value = '';
            }
        }
        
        function removeCheckbox() {
            var tagOpts = document.getElementsByClassName('custom-tags')[0];
            var checkboxes = tagOpts.querySelectorAll('input[type="checkbox"]');
            var lastCheckbox = checkboxes[checkboxes.length - 1];
            if (lastCheckbox) {
              lastCheckbox.closest('div').parentNode.removeChild(lastCheckbox.closest('div'));
            }
          }

        function uploadFile() {
            var formData = new FormData(document.getElementById('uploadForm'));
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/upload', true);
        
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.resultText && response.detail) {
                        document.getElementById('uploadResultText').textContent = response.resultText;
                        document.getElementById('uploadResultDetail').textContent = response.detail;
                        
                        if (response.resultText === 'Upload Success') {
                            // è·³è½‰åˆ° "Upload Result" æ¨™ç±¤
                            openTab(null, 'result');
                        }
                    }
                }
            };
        
            xhr.send(formData);
        }

    </script>

</body>

</html>